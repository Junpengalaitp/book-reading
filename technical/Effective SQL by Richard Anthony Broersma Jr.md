# 第一章 数据模型设计
* 想要轻松写出高效的SQL, 要有优秀的数据库设计。如果数据库设计违反了本章中的原则，应当找到问题并修复。
* 如果数据库不在你的控制之下，至少你要能够理解你面对的问题是什么，然后再把你认为可行的方案解释给有设计权力的人。
* 即使你没办法改变设计，在SQL中也有其他的变通方案可以解决某些问题。

## 第1条：确保所有表都有主键

## 第2条：避免存储冗余数据

## 第3条：消除重复数据组

## 第4条：每行只存储一个属性

## 第5条：理解为什么存储计算列通常有害无益
* 在数仓中可行，ods中会带来性能问题

## 第6条：定义外键以确保引用完整性

## 第7条：确保表间关系的合理性

## 第8条：当第三范式不够时，采用更多范式

## 第9条：非规范化数据仓库

# 第二章 可编程性与索引设计

## 第10条：创建索引时空值的影响

## 第11条：创建索引是谨慎考虑以最小化索引和数据扫描

## 第12条：索引不只是过滤

## 第13条：不要过度使用触发器

## 第14条：使用过滤索引包含或排除数据子集

## 第15条：使用声明式约束替代编码校验

## 第16条：了解数据库使用的SQL方言并编写相应的代码

## 第17条：了解何时在索引中使用计算结果

# 第3章 当你不能改变设计时

## 第18条：使用视图（view）来简化不能更改的内容

## 第19条：使用ETL将非关系数据库转化为有用的信息

## 第20条：创建汇总表并维护

## 第21条：使用UNION语句将非规范化数据列转行
* SELECT Category, 'OCT' AS sales_month, OctQuantity AS Quantity, OctSales AS SalesAmt
  FROM SalesSummary
  UNION 
  SELECT Category, 'Nov', NovQuantity, NovSales
  FROM SalesSummary
  UNION 
  SELECT Category, 'Dec', DecQuantity, DecSales
  FROM SalesSummary

# 第4章 过滤与查找数据

## 第22条：了解关系代数及其如何在SQL中实现
* 选择：选择行
* 投影：选择列
* 连接
* 交集
* 笛卡尔积：cross join
* 并集
* 除
* 差集：EXCEPT

## 第23条：查找不匹配或缺失的记录
* NOT IN 
* NOT EXISTS
* LEFT JOIN

## 第24条：了解何时使用CASE解决问题
* 在任何需要将表达式作为SELECT子句的返回列，或作为WHERE和HAVING子句的搜索条件时


## 第25条：了解解决多条件查询的技术
* 使用函数正确地解决复合条件

## 第26条：如需完美匹配，先对数据进行除操作
* 查找符合给定工作所有要求的所有应职者
* 列出可以提供构造组件零件的所有供应商
* 显示订购某一套产品的所有客户

## 第27条：如何按时间范围正确地过滤日期和时间的列
* 使用DATEADD()函数
* 不要依赖隐式日期转化，使用显式转化函数来处理日期字符
* 不要将函数应用于日期和时间列，否则查询将不能使用索引
* 使用>=和\<代替BETWEEN


## 第28条：书写可参数化搜索的查询以确保引擎使用索引

## 第29条：正确地定义左连接的右侧
* 在SQL中使用OUTER JOIN执行差集操作
* 当你对外部WHERE子句中的左连接加入右侧数据使用过滤时，你将无法获得所需要的结果
* 要正确地过滤数据子集，必须在数据库系统执行外连接之前使用过滤

# 第5章：聚合

## 第30条：理解GROUP BY的工作原理
* FROM子句生成数据集
* WHERE子句过滤有FROM子句生成的数据集
* GROUP BY子句聚合由WHERE子句过滤的数据集
* HAVING子句转换过滤的聚合数据集
* SELECT子句转换过滤的聚合数据集
* ORDER BY子句对变换后的数据集进行排序

## 第31条：简化GROUP BY子句
* 对于同时需要聚合和详细信息的查询，首先在子查询中执行所有聚合，然后将结果再连接到其他表以查询详细信息

## 第32条：利用GROUP BY或HAVING解决复杂问题
* HAVING能够将一个组的总体结果与另一个聚合结果进行比较

## 第33条：避免使用GROUP BY解决寻找MAX,MIN
* 使用LEFT JOIN主表联接到自身
* 将GROUP BY子句中的每一列都变成ON子句的一部分，并使用=进行比较
* MAX()或MIN()子句中的列将变成ON子句的一部分，并且使用小于或大于
* 应该为ON子句的列添加索引，以获得更好的性能

