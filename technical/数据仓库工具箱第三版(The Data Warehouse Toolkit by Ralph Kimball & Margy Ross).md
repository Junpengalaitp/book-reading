# 第一章 数据仓库、商业智能及维度建模初步
* DW/BI的业务驱动目标
* 发布DW/BI系统的隐喻
* 维度建模核心概念及涉及的主要词汇，包括事实表与维度表
* Kimball DW/BI架构的组件与原则
* 不用DW/BI架构的比较研究，维度建模在不同架构中所扮演的角色
* 有关维度建模的误解

## 1.1 数据获取与数据分析的区别
* 操作型系统保存数据，DW/BI系统使用数据。
* 操作型系统优化的目的使更快地处理单条事务。
* DW/BI系统一次处理大量事务，优化的目的是高性能地完成查询。

## 1.2 数据仓库与商业智能的目标
* 收集了海量数据，但无法对其访问
* 需要以各种方式方便地对数据进行切片切块
* 业务人员需要方便地获得数据
* 展示最重要的事情
* 利用数据进行决策而不是争论数据的准确性
* 使人们能够使用信息来支持更多的基于事实的决策制定
* DW/BI系统的业务需求
  * 方便地存取信息，其内容必须使易于理解的，对业务用户（不仅是开发人员）来说，数据要有直观性。数据结构与标识必须符合用户的思维过程和词汇。业务用户能以各种形式分割和合并分析数据。访问数据的工具和应用要简单易用，性能良好（简单快捷）。
  * 必须以一致的形式展现信息。精心组织不同来源的数据，实现数据清洗，确保质量，只有在数据真正适合用户时发布。一致性也意味着表示DW/BI系统内容的公共标识和定义，可在不用数据源共用。保证同名同意性和异名异名性。
  * 必须能适应变化。当业务问题发生变化或新数据添加到数据仓库中时，已存在的数据和应用不应该被改变或破坏。如果必须修改系统中的描述性数据，要能以适当的方式描述变化，并使这些变化对用户来说是透明的。
  * 必须能够及时展现信息。
  * 必须成为保护信息财富的安全堡垒。
  * 必须称为提高决策制定能力的权威和可信的基础。
  * 成功的标志是业务群体接受DW/BI系统。
* 最后两项至关重要。

### 以出版发行工作为例说明BW/BI管理者的职责
* 理解读者
  * 读者的人口统计学特征
  * 读者希望的内容
  * 高价值客户
  * 潜在的新读者
* 确保杂志对读者具有吸引力
  * 内容要有吸引力
  * 杂志的布局和设计要喜闻乐见
  * 高质量的写作和编辑标准，且具有一致性
  * 不断地监控杂志中文章的准确性以及广告商的要求
  * 根据读者和撰稿人网络的新情况适时改变读者信息及保证修改即时可用
* 维持出版
  * 吸引广告商，带来利润
  * 定期出版杂志
  * 保持读者对杂志的信任
  * 让投资人满意

#### DW/BI管理者的责任
* 理解业务用户
  * 理解他们的工作责任、目标和任务
  * 确定商业用户在制定出高效率、高影响的决策的最佳用户
  * 发现潜在的新用户，并让他们意识到DW/BI系统带来的好处
* 对业务用户发布高质量、相关的、可访问的信息和分析
  * 选择最健壮的、可操作的数据放入DW/BI系统中，从组织机构的各种数据源中仔细选择。
  * 简化用户接口和应用，采用模板驱动的方式，与用户的认知过程轮廓匹配
  * 确保数据精确、可信，使其标识在整个企业具有一致性
  * 不间断地监控数据和分析的准确性
  * 适应用户不断变化的思维方式、需求和业务优先级，及新数据源的可用性
* 维护DW/BI环境
  * 采用DW/BI系统制定成功的业务决策，验证人员配置及要投入的开支
  * 定期对DW/BI系统进行更新
  * 保持业务用户的信任
  * 保持业务用户、执行赞助商和IT管理层满意度

## 1.3 维度建模简介
* 需求
  * 以商业用户可理解的方式发布数据
  * 提供高效的查询性能
* 维度模型通常应用在关系型数据库管理系统上，但不要求维度模型必须满足第三范式(3NF)。数据库中强调3NF主要使为了消除冗余。规范化的3NF将数据划分为多个不同的实体，每个实体构成一个关系表。
* 规范化的3NF模型对于BI来说太复杂。用户难以理解、检索和记忆。而且多数数据库管理系统不能有效地查询规范化模型，用户查询难以预测的复杂性将耗尽数据库资源，产出灾难性的后果。在DW/BI这样展现系统中使用规范化建模方法难以满足对数据的高性能检索需求。维度建模解决了模式过分复杂的问题。

### 1.3.1 星型模式与OLAP多维数据库
* 在关系数据库管理系统中实现的维度模型称为星型模式。
* 在多维数据库环境中实现的维度模型称为OLAP。
* 星型模式和多维数据库对可识别的维度具有公共的逻辑设计，但在物理实现上存在差异。
### 1.3.2 用于度量的事实表
* 存储机构业务过程事件的表现度量结果。应该尽量将来源于同一个业务过程的底层度量结果存储于一个维度模型中。
* 因为度量的数据量巨大，不应该为满足多个组织功能的需要而分开存放数据，而应该允许多个组织业务用户访问同一个单元的集中式数据仓库，确保他们能在整个企业中使用一致的数据。
* "事实"这一术语表示某个业务度量，事实表中的每行对应一个度量事件。每行中的数据是一个特定级别的细节数据，称为粒度。
* 物理世界的每一个度量事件于对应的事实表具有一对一的关系，这一思想是维度建模的基本原则。其他工作都是以此为基础建立的。
* 可加性是至关重要的，应为BI应用会检索大量的行，所以常见的操作是将它们加到一起。销售数量和金额具有可加性，账户结余只有半可加性，而单位价格不可加。面对这种情况时，会不得不进行计数或取均值操作。
* 事实通常以连续值描述，这样做有助于区分到底是事实还是属性维度的问题。例如销售额是连续值，这样它可以在一定范围内表示实际可能存在的所有值。必须面向市场，研究度量，以确定其度量值到底应该是什么。
* 没有发生的事实不要插入任何行，不要试图以0表示没有活动发生。
* 事实表的粒度可划分为三类：事务、周期性快照和积累快照。事务粒度级别的事实表最常见。
* 事实表通常具有两个或更多个外键与维度表的主键关联。
* 事实表通常包含外键集合的主键，事实表的主键常称为组合键，具有组合键的表称为事实表，表示多对多关系。其他表称为维度表。
* 通常几个维度一起标识每个事实表行。当确定了所有维度中唯一标识事实表行的子集后，其他维度使用事实表行的主键单一值，其他维度只是参于其中。

### 1.3.3 用于描述环境的维度表
* 维度表是事实表不可或缺的组成部分，包含与业务过程度量事件有关的文本环境。它们用于描述与"who, what, where, when, why, how"有关的事件。
* 维度表通常有多列，包含多个属性。有上百个属性的维度表并不稀奇。与事实表相比，维度表趋向于包含较少的行，但由于可能存在大量文本列而导致存在多列的情况。每个维度表由单一主键定义，用于在事实表连接操作时实现参照完整性的基础。
* 维度属性可作为查询约束、分组、报表标识的主要来源。属性应该使用真实词汇而不是缩写或代码。
* 数据仓库的好坏直接取决于维度属性的设置，DW/BI的分析能力直接取决于维度属性的质量和深度。为维度属性提供详细的业务术语耗费的精力阅读，效果就越好。为属性列填充领域值耗费的精力越多，效果就越好。为确保属性值的质量耗费的时间越多，效果就越好。强大的维度属性带来的回报是健壮的分片-分块分析能力。
* 分析操作型源数据时，有时不清楚一个数值数据元素应该时事实属性还是维度属性。可用通过分析该列是否是一种包含多个值并作为计算的参与者的度量，这种情况下该列往往可能是事实。如果该列是对具体值的描述，是一个常量、某一约束和行标识的参与者，此时该属性往往是维度属性。
* 一个数字是事实还是维度，是一个两难的问题。连续的数字基本上可以认为属于事实，来自一个不太大的列表的离散数字基本可以认为是维度属性。
* 维度表通常比较小，因此采用规范化或雪花模式对数据库总量没有很大影响。一般对维度空间表存储空间的权衡往往需要关注简单性和可访问性。

### 1.3.4 星型模式中维度与事实的连接
* 星型连接：维度模型表示每个业务过程包含事实表，事实表存储事件的数值化度量，围绕事实表的是多个维度表，维度表包含事件发生时实际存在的文本环境。
* 对维度模式首先要注意的时其简单性和对称性。显然，简单性对业务用户有利，因为数据易于理解和查询。
* 维度模型的简单性也带来性能上的好处，数据库优化器处理这些很少使用连接操作的简单模式会更高效。
* 维度模型非常适用于变化，它可预测的框架可适应用户行为的变化。每个维度的地位都相同，所有维度在事实表中都存在对应的入口点。
* 粒度最小的数据或原子数据具有最多的维度。尚未聚集的原子数据时最具有可表达性的数据。这些原子数据是构建能满足用户提出任意查询的事实表的设计基础。
  * 可以将全新维度增加到模式中，只要该维度的单一值被定义到已经存在的事实表行中。
  * 同样，可以将新的事实添加到事实表中，前提是其细节级别与当前事实表保持一致。
  * 可以向已存在的维度表添加新属性，对上述情况，可以通过简单增加数据行或通过执行SQL ALTER TABLE命令对当前表进行更新。不需要重新加载数据，已经建立的BI系统应用可不间断允许，不会产生不同的结果。

## 1.4 Kimball的DW/BI架构
* 四个不同的组成部分
  * 操作型源系统
  * ETL系统
  * 数据展现
  * 商业智能应用

### 1.4.1 操作型源系统
* 记录的操作型系统，用于获取业务事务，处于数据仓库之外，几乎不能控制这些操作型系统中数据的格式和内容。
* 关注处理性能和可用性。
* 查询是简单的，以一次一条记录的查询方式构成常见的事务流，通常不能实现类似DW/BI系统那样广泛的、无法预料的查询方式的特点。
* 一般不维护历史信息，好的数据仓库来承担这个责任。
* 一种针对特定意图的应用，并未承诺要与组织中其他操作型系统共享诸如产品、客户、区域、日期这样的公共数据。

### 1.4.2 获取-转换-加载(ETL)系统
* 包括一个工作区间、实例化的数据结构以及一个过程集合。是处于操作型源系统与DW/BI展现系统之间的区域。
* 获取是将数据从操作型系统导入到数据仓库这一ETL过程的第一步，意味着读取并立即源数据并将需要的数据复制到ETL系统中以利于后续的处理操作。
* 获取到ETL系统后，需要进行多种转换操作，例如清洗数据，合并不同来源的数据，复制数据等。ETL系统通过增强或数据变换，采用清洗和整合上述任务的方法，增加数据的利用价值。这些工作还可以建立诊断元数据，逐步建立业务过程再工程以改进源系统的数据质量。
* 最后的步骤就是实际构建和加载数据到展现区域的目标维度模型中。因为ETL系统的注意任务是在交付过程中划分维度和事实，因此其所包含的子系统非常重要。此处定义的子系统关注维度表的处理，例如代理键分配、查找代码以提供适当的描述、拆分或组合列以提供适当的数据值、连接满足第三范式的数据表成为扁平的不满足规范化要求的维度等。相比之下，事实表往往比较庞大，因此在加载时需要大量时间，将其加载并导入到展现区是必须开展的工作。当维度模型中的维度表和事实表被更新、索引、适当聚集并确保良好质量后，业务用户就可以开始使用这样数据了。

### 1.4.3 用于支持商业智能决策的展现区
* ETL不允许用户直接查询，所以DW/BI环境中的展现区成为用户关注的区域。
* 数据应该以维度模型来展现，要么采用星型模式，要么采用OLAP多维数据库。
* 必须包含详细的原子数据。为满足用户无法预期的、随意的查询，必须使用原子数据。尽管在展现区，为提高性能也会存储聚集数据，但若仅有这些汇总数据而没有形成汇总数据的细粒度数据，则这样的展现区是不完整的。
* 展现区的数据可以围绕业务度量事件来构建。采用这一方法可以自然地裁剪操作型源数据获取系统。维度模型应该对应物理数据获取事件，不应该将它们设计为仅为完成每天的报表工作。应该为原始的销售矩阵建立单一事实表而不是仅从相似性来考虑问题。数据库的销售矩阵应该包含与销售、市场、部门和财务有关的项。
* 必须使用公共的、一致性的维度建立维度结构。
* 利用总线结构建立分布式DW/BI系统是成功的关键。将总线结构作为级别框架，可采用敏捷的、分散的、范围合适的、迭代的方式建立企业数据仓库。

### 1.4.4 商业智能应用
* BI应用可以简单或复制。多数业务用户可能通过预先构建参数驱动的应用和模板访问数据，不需要用户直接构建查询。对那些更加复杂的应用，可以将结果上传值操作型源系统、ETL系统或展现区中。

### 1.4.5 以餐厅为例描述Kimball架构
#### 1. ETL系统与餐厅后厨
* 自成体系，不受外界业务打扰。
* ETL系统需要高度关注数据质量、完整性、一致性。输入数据时要检查其质量。不断地监视相关的环境以确保ETL输出的数据具有高度的完整性。
* 设计恰当的DW/BI环境将平衡前端BI应用以支撑后端ETL系统。前端的工作需要由商业用户多次反复实现，后端工作由ETL人员一次实现。
* ETL系统应该与业务用户和BI应用开发者保持一定距离。

#### 2. 处于前端用餐区的数据展现与BI
* DW/BI系统提供菜单，通过元数据、发布报表、参数化分析应用等告诉用户什么数据可用。用户希望获得一致的、良好的数据质量。展现区的数据应该根据要求准备并保证安全。
* 展现区的"装修风格"应该让用户感觉舒服，应该按照BI使用者的口味而不是开发者的喜好进行设计。
* 成本也是必须考虑的问题。

## 1.5 其他DW/BI架构
### 1.5.1 独立数据集市架构

### 1.5.2 辐射状企业信息工厂Inmon架构

### 1.5.3 混合辐射状架构与Kimball架构

## 1.6 维度建模Myth
### 1.6.1 Myth 1: 维度模型仅包含汇总数据
* 汇总数据只是针对公共查询时能够比粒度数据提供更好的性能，但它不能取代细节数据。
* 维度模型不反对存储大量历史数据，但是必须由业务需求来驱动。

### 1.6.2 Myth 2: 维度模型是部门级而不是企业级的
* 应该避免多次获取同一个数据源的数据，这样做会产生多个不一致的分析数据库

### 1.6.3 Myth 3: 维度模型是不可扩展的
* 好的维度模型非常易于扩展。

### 1.6.4 Myth 4: 维度模型仅用于预测

### 1.6.5 Myth 5: 维度模型不能被集成
* 如果遵从企业数据仓库总线结构，维度模型多数都能被集成。

## 1.7 考虑使用维度模型的更多理由
### 敏捷性
* 多数敏捷方法的核心原则与Kimball最佳实践契合
  * 关注发布业务值
  * 开发小组与业务相关方之间的值合作
  * 强调与业务相关方开展面对面的沟通、反馈、优化。
  * 快速适应不可避免的需求变化
  * 以迭代、增量方式处理开发过程

# 第二章 Kimball维度建模技术概述
## 2.1 基本概念
### 2.1.1 收集业务需求与数据实现
* 开始维度建模工作前，项目组需要理解业务需求，以及作为基础的源数据的实际情况。通过与业务代表交流来发现需求，用于理解他们的基于关键性能指标、竞争性商业问题、决策制定过程、支持分析需求的目标。同时，数据实际情况可用通过与源系统专家交流，构建高层次数据分析访问数据可行性来揭示。

### 2.1.2 协作维度建模研讨
* 维度模型应该由主题专家与企业数据管理代表合作设计而成。工作由数据建模者负责，但模型应该通过与业务代表开展一系列高级级别交互讨论获得。这些讨论组也为丰富业务需求提供了一次机会。维度模型不应该由那些不懂业务以及业务需求的人来设计，协作是成功的关键。

### 2.1.3 4步骤维度设计过程
* 选择业务过程
* 生命粒度
* 确认维度
* 确认事实

### 2.1.4 业务过程
* 组织完成的操作型活动，例如获得订单、处理保险索赔、学生课程注册或每个月每个账单的快照等。业务过程实际建立或获取性能度量，并转换为事实表中的事实。多数事实表关注某一业务过程的结果。过程的选择是非常重要的，因为过程定义了特定的设计目标以及对粒度、维度、事实的定义。每个业务过程对应企业数据仓库总线矩阵的一行。

### 2.1.5 粒度
* 声明粒度是维度设计的重要步骤，粒度用于确定某一事实表中的行表示什么。粒度声明是设计必须履行的合同。在选择维度或事实前必须声明粒度，因为每个候选维度或事实必须与定义的粒度保持一致。在所有维度设计中强制实现一致性是保证BI应用性能和易用性的关键。在从给定的业务过程获取数据时，原子粒度是最低级别的粒度。建议从关注原子级别粒度数据开始设计，因为它能够承受无法预期的用户查询。汇总粒度对性能调整来说非常重要，但这样的粒度往往要猜测业务公共问题，针对不同的事实表粒度，要建立不同的物理表，在同一事实表中不要混用多种不同的粒度。

### 2.1.6 描述环境的维度
* 维度表包含BI应用所需要的用于过滤及分类事实的描述性属性。牢牢掌握事实表的粒度，就能将所有可能存在的维度区分开。当给定事实表行关联时，任何情况下都应使维度保持单一值。

### 2.1.7 用于度量的事实
* 事实涉及来自业务过程事件的度量，基本上都是以数量值表示。一个事实表行与按照事实表粒度描述的度量事件之间存在一对一关系，因此事实表对应一个物理可观察事件。在事实表内，所有事实值允许声明的粒度保持一致。例如在零售事务中，销售产品的数量与其总额是良好的事实，但是经理的工资不允许出现在零售事务中。

### 2.1.8 星型模式与OLAP多维数据库
* 星型模式是在关系型数据库之上的多维结构。主要包含事实表，以及通过主键、外键关系与之关联的维度表。
* OLAP多维数据库是实现在多维数据库之上的多维结构，它与关系型星型模式内容等价，或者是来源于关系型星型模式。包含维度属性和事实表，但它能够使用比SQL语言更强的分析语言访问。

### 2.1.9 方便地扩展到维度模型
* 当事实与存在的事实表粒度一致时，可创建新列
* 通过建立新的外键列，可将维度关联到已经存在的事实表上，前提时维度列与事实表粒度保持一致
* 可在维度表上通过建立新列添加属性
* 可使事实表的粒度更原子化，方法使在维度表上增加属性，然后以更细的粒度重置事实表，小心保存事实表及维度表的列名。

## 2.2 事实表技术基础

### 2.2.1 事实表结构
* 发生在现实世界中的操作型事件，其所产生的可度量数值，存储在事实表中。从最低的粒度级别来看，事实表行对应一个度量事件，反之亦然。因此事实表的涉及完全依赖于物理活动，不受可能产生的最终报表影响。除了数字度量外，事实表总是包含外键，用于关联与之相关的维度，也包含可选的退化键和日期。查询的目的是基于事实表开展计算和聚集操作。

### 2.2.2 可加、半可加、不可加事实
* 事实表中的数字度量可划分为三类。最灵活、最有用的事实是完全可加，可加性度量可用按照与事实表关联的任意维度汇总。
* 半可加度量可用对某些维度汇总，但不能对所有维度汇总。
* 完全不可加维度，尽可能存储非可加度量的完全可加分量，并在计算出最终的非可加事实前，将这些分量汇总到最终的结果集合中。最终计算通常发生在BI层或OLAP多维数据库层。

### 2.2.3 事实表中的空值
* 事实表中可用存在空值度量。聚集函数可针对空值事实计算。然而在事实表的外键中不能存在空值，否则会导致违反参照完整性的情况发生。关联的维度表必须使用默认行(代理键)而不是空值外键表示未知的或无法应用的条件。

### 2.2.4 一致性事实
* 如果某些度量出现在不同的事实表中，需要注意，如果需要比较或计算不同事实表中的事实，应保证针对事实的技术定义是相同的。如果不同的事实表定义是一致的，则这些一致性事实应该具有相同的命名，如果它们不兼容，则应该有不同的命名用于告诫业务和BI应用。

### 2.2.5 事务事实表
* 一行对应空间或时间上某点的度量事件。原子事务粒度事实表是维度化及可表达的事实表，这类健壮的维度确保对事务数据的最大化分片和分块。事务事实表可是稠密或稀疏的，因为仅当存在度量时才会建立行。这些事实表总数包含一个与维度表关联的外键，也可能包含精确的时间戳和退化维度键。度量数字事实必须与事务粒度保持一致。

### 2.2.6 周期快照事实表
* 每行汇总了发生在某一标准周期的度量事件。粒度是周期性的，而不是个体的事务。周期快照事实表通常包含许多事实，因为任何与事实粒度表一致的度量事件都是被允许存在的。这些事实表其外键的密度是均匀的，因为及时周期内没有活动发生，也会在事实表中为每个事实插入包含0或空值的行。

### 2.2.7 累积快照事实表
* 汇总了发生在过程开始和结束之间可预测步骤内的度量事件。

### 2.2.8 无事实的事实表
* 尽管多数度量事件获取的结果是数字化的，但也存在某些事件仅记录一系列某时刻发生的多维实体。

### 2.2.9 聚集事实表或OLAP多维数据库
* 聚集事实表是对原子粒度事实表数据进行简单的数字化操作，目的是为了提高查询性能。

### 2.2.10 合并事实表
* 通常将来自多个过程的，以相同粒度表示的事实合并为一个单一的合并事实表，这样能够带来方便

## 2.3 维度表技术基础

### 2.3.1 维度表结构
* 每个维度表都包含单一的主键列，可以作为与之关联的任何事实表的外键，维度表行的描述环境应与事实表行完全对应。维度表通常比较宽，是扁平型非规范表，包含大量的低粒度的文本属性。操作代码与指示器可作为属性对待，最强有力的维度属性采用冗长的描述填充。维度表属性是查询及BI应用的约束和分组定义的主要目标。报表的描述性标识通常是维度表属性领域值。

### 2.3.2 维度代理键
* 维度表中会包含一个列，表示唯一主键。该主键不是操作型系统的自然键，由于需要跟踪变化，因此若采用自然键，将需要多个维度行表示。另外，维度的自然键可能由多个源系统建立，这些自然键将出现兼容性问题，难以管理。

### 2.3.3 自然键、持久键和超自然键
* 由操作型系统建立的自然键受业务规则影响，无法被DW/BI系统控制。数据仓库希望创建单一键，这就需要建立新的持久键以确保在此种情况下，雇员号保持持久性不发生变化。该键有时被称为持久性超自然键。最好的持久键其格式应该独立于原始的业务过程，并以整数1开始进行分配。

### 2.3.4 下钻
* 仅需要在查询上增加一个行头指针。新行的头指针是一个维度属性，附加了SQL语言的GROUP BY表达式。属性可以来自任何查询使用的事实表关联的维度。下钻不需要预先存在层次的定义。

### 2.3.5 退化维度
* 有时，维度除了主键外没有其他内容。

### 2.3.6 非规范化扁平维度
* 一般来说，维度设计者需要抵制由多年来操作型数据库设计所带来的规范设计的要求，并将规范化的多对一固定深度层次引入扁平维度行的不同属性。非规范化维度能够实现维度建模的双重目标：简化及速度。

### 2.3.7 多层次维度
* 多数维度包含不止一个自然层次。例如日历日期维度可以按照财务周期层次从天到周进行划分，也可能存在从天到月再到年的层次。位置密集型维度可能包含多个地理层次。

### 2.3.8 文档属性的标识与指示器
* 令人迷惑的缩写、真假标识以及业务指标可以作为维度表中文本字词含义的补充解释。操作代码值所包含的意义应分解成不同的描述性维度属性的部分。

### 2.3.9 维度表中的空值属性
* 当给定维度行没有被全部填充时，或当存在属性没有被应用到所有维度行时，将产生空值维度属性。上述两种情况下，我们推荐采用描述性字符串替代空值。应该避免使用空值，因为不同的数据库系统在处理分组和约束时，针对空值的处理方法不一致。

### 2.3.10 日历日期维度
  
### 2.3.11 扮演角色的维度
* 单个物理维度可以被事实表多次引用，每个引用连接逻辑上存在差异的角色维度。

### 2.3.12 杂项维度

### 2.3.13 雪花维度

### 2.3.14 支架维度

## 2.4 使用一致性维度集成
* 维度建模方法最成功的方面就是为了集成来自不同的商业过程的数据而定义了简单而强大的解决方案
### 2.4.1 一致性维度
* 当不同的维度表的属性具有相同的列名和领域内容时，称维度表具有一致性。利用一致性维度属性与每个事实表关联，可将来自不同事实表的信息合并到同一报表中。当一致性属性被用作行头时，来自不同的事实表的结果可以排列到跨报表的同一行中。

### 2.4.2 缩减维度
* 缩减维度时一种一致性维度，由基本维度的列或行的子集构成。当构建聚集事实表时需要缩减上卷维度。当商业过程自然地获取粒度级别较高的数据时，也需要缩减维度。

### 2.4.3 跨表钻取
* 当每个查询的行头包含相同的一致性属性时，使不同的查询能够针对两个或更多的事实表进行查询。

### 2.4.4 价值链
* 价值链用于区分组织中主要业务过程的自然流程。操作型源系统通常为价值链上的每个步骤建立事务或快照。因为每个过程在特定时间间隔，采用特定的粒度和维度建立唯一的度量，所以每个过程通常至少建立一个原子事实表。

### 2.4.5 企业数据仓库总线架构
* 关注业务过程将DW/BI规划过程分解为可管理的模块，通过重用跨不同过程的标准化一致性维度发布实现集成。企业数据仓库总线架构提供了一种架构性框架，同时也支持可管理敏捷实现对应企业数据仓库总线矩阵。

### 2.4.6 企业数据仓库总线矩阵
* 企业数据仓库总线矩阵是用于设计并与企业数据仓库总线架构交互的基本工具。矩阵的行表示业务过程，列表示维度。矩阵中的点表示维度与给定的业务过程是否存在关联关系。

### 2.4.7 总线矩阵实现细节
* 一个更加粒度化的总线矩阵，其中扩展每个业务过程行以展示特定事实表或OLAP多维数据库，在此细节粒度上，可以文档化精确的粒度描述以及事实列表。

### 2.4.8 机会/利益相关方矩阵
* 在确定了企业数据仓库总线矩阵行之后，可以通过替换包含业务功能的维度列规划不同的矩阵。通过确定矩阵点以表示哪些业务功能与哪些业务过程行相关。机会/利益相关方矩阵可用于区分哪些业务过程分组应该与过程中心行相关。

## 2.5 处理缓慢变化维度属性
### 2.5.1 类型0：原样保留
### 2.5.2 类型1：重写
### 2.5.3 类型2：增加新行
### 2.5.4 类型3：增加新属性
### 2.5.5 类型4：增加微型维度
### 2.5.6 类型5：增加微型维度及类型1支架
### 2.5.7 类型6：增加类型1属性到类型2维度
### 2.5.8 类型7：双类型1和类型2维度

## 2.6 处理维度层次关系
### 2.6.1 固定深度位置的层次
* 多对一关系的一种，例如产品->品牌->分类->部门。
* 当固定深度层次完成定义后，层次就具有商定的名字，层次基本作为维度表中不同位置属性出现。

### 2.6.2 轻微参差不齐/可变深度层次
* 与其使用复杂的机制构建难以预测的可变深度层次，不如将其变换为固定深度位置设计，针对不同维度属性确立最大深度，然后基于业务规则放置属性值。

### 2.6.3 具有层次桥接表的层次不齐/可变深度层次
* 在关系数据库中采用构建桥接表方式建模参差不齐层次来解决。这样桥接表对每个可能的路径保留一行，确保能够遍历所有层次的形式，才有标准SQL而不是特定语言扩展来实现。

<<<<<<< HEAD
=======
### 2.6.4 具有路径字符属性的可变深度层次
* 可以在维度中采用路径字符属性，以避免使用桥接表表示可变深度层次。对维度中的每行，路径字符属性包含特定的嵌入文本字符，包含从层次最高节点到特定维度行所描述节点的完整路径描述。多数标准层次分析需求可以通过标准SQL处理，不必采用SQL语言扩展。然而路径字符方法不能确保其他层次的快速替换，也无法保证共享自身层次。路径字符方法也难于构建可变路径层次的变化，可能需要重新标记整个层次。

## 2.7 高级事实表技术

### 2.7.1 事实表代理键
* 代理键可用作所有维度表的主键。此外，可使用单列代理事实键，尽管不太需要。不与任何维度关联的事实表代理键，是在ETL加载过程中顺次分配的。可用于作为事实表的唯一主键列。
* 在ETL中，用作事实表行的直接标识符，不必查询多个维度。
* 允许将事实表更新操作分解为风险更小的插入和删除操作。

### 2.7.2 蜈蚣事实表
* 应该避免，所有固定深度的、多对一层次关联的维度都应该回到它们最细节的粒度上。当设计者将多个外键嵌入到单一低粒度维度表中，而不是建立杂项维度时，也会产生蜈蚣事实表。

### 2.7.3 属性或事实的数字值
### 2.7.4 日志/持续时间事实
### 2.7.5 头/行事实表

### 2.7.6 分配的事实
### 2.7.7 利用分配建立利润与损失事实

### 2.7.8 多种货币事实

### 2.7.9 多种度量事实单位
### 2.7.10 年-日事实
### 2.7.11 多遍SQL以避免事实表间的连接
### 2.7.12 针对事实表的时间跟踪

### 2.7.13 迟到的事实

## 2.8 高级维度技术
### 2.8.1 维度表连接
### 2.8.2 多值维度与桥接表
### 2.8.3 随时间变化的多值桥接表
### 2.8.4 标签的时间序列行为
### 2.8.5 行为研究分组
### 2.8.6 聚集事实作为维度属性
### 2.8.7 动态值范围
### 2.8.8 文本注释维度
### 2.8.9 多时区

### 2.8.10 度量类型维度
### 2.8.11 步骤维度
### 2.8.12 热交换维度
### 2.8.13 抽象通用维度
### 2.8.14 审计维度
### 2.8.15 最后产生的维度

## 2.9 特殊目的模式
### 2.9.1 异构产品的超类与子类模式
### 2.9.2 实时事实表
### 2.9.3 错误事件模式
>>>>>>> 449509c2f80a8c632dcde68423649e3939a798bc


# 第三章 零售业务
## 3.1 维度模型设计的4步过程
### 3.1.1 第一步：选择业务过程
* 组织完成的微观活动，例如获得订单、开局发票、接收付款、处理服务电话、注册学生、执行医疗程序、处理索赔等。
  * 业务过程通常用行为动词表示，因为它们通常表示业务执行的活动，与之相关的维度描述与每个业务过程事件关联的描述性环境。
  * 业务过程通常由某个操作型系统支撑，例如账单和下单系统。
  * 业务过程建立或获取关键性能度量。有时这些度量是业务过程的直接结果，度量从其他时间获得。分析人员总数想通过过滤器和约束不同组合，来审查和评估这些度量。
  * 业务过程通常由输入激活，产生输入度量。在许多组织中，包含一系列过程，它们及时某些过程的输出，也是某些过程的输入。一系列事实产生一系列事实表。

### 3.1.2 第二步：声明粒度
* 精确事实表的某一行表示什么。粒度传递的是与事实表度量有关的细节级别
  * 客户销售事务上的每个产品扫描到一行中
  * 医生开具的票据的列表内容项采用一行表示
  * 机场登机口处理的每个登机牌采用一行表示
  * 仓库中每种材料库存水平的每日快照采用一行表示
  * 每个银行账户每月的情况采用一行表示

### 3.1.3 第三步：确定维度
* 解决如何描述来自业务过程度量事件的数据。应当使用健壮的维度集合来装饰事实表，这些维度表示承担每个度量环境中所有可能的单值描述符。
* 维度通常易于区分，它们表示5W1H的关联事件。

### 3.1.4 第四步：确定事实
* 通过分析过程的度量来确定事实。商业用户非常愿意分析这些性能度量

## 3.2 零售业务案例研究
* 对零售来说，管理上主要关注对订单、库存、销售产品的组织工作，目的是实现利润最大化。利润最终来源赚取每种商品尽可能多的差价，降低获得产品的成本，提供有竞争力的环境以吸引更多顾客。

### 3.2.1 第一步：选择业务过程
* 通过对业务需求以及可用数据源的综合考虑，决定对哪种业务开展建模工作。
* 第一个DW/BI项目应该将注意力放在最为关键的、最易实现的用户业务过程。包括数据可用性和质量以及组织的准备工作等。

### 3.2.2 第二步：声明粒度
* 设计开发的维度模型应该表示由业务过程获取的最详细的原子信息。不是因为需要查询单独的某行，而是因为查询需要以非常精确的方式对细节进行切分，

### 3.2.3 第三步：确立维度
* 详细的粒度说明确定了事实表的主要维度，然后可以将更多维度增加到事实表上，只要这些额外的维度自然地承担主维度合并的某个值。如果附加的维度会产生与粒度不符的其他事实行，则取消该维度或重新考虑粒度声明。

### 3.2.4 第四步：确定事实
* 计算获得的事实
* 不可加事实
* 事务事实表

## 3.3 维度表设计细节
### 3.3.1 日期维度
* 日期维度是一种特殊的维度，因为它几乎出现在所有的维度模型中。实际上每个业务过程都需要获取时间序列的性能度量。
* 与多数其他维度不同，可以提前建立日期维度表。可以在表中按行表示10年或20年的不同日期。

### 3.3.2 产品维度
* 产品维度描述仓库中存储的每个SKU, 几乎总是来源于操作型产品主文件。
#### 1. 扁平化多对一层次
#### 2. 具有内嵌含义的属性
#### 3. 作为属性或事实的数字值
#### 4. 下钻维度属性

### 3.3.3 商店维度
#### 1. 多层次维度表
#### 2. 维度表中的日期

### 3.3.4 促销维度
* 促销产品销量是否大幅增加
* 促销活动结束后销量的变化
* 销售侵蚀
* 促销产品是否获得了净增益
* 促销是否有利润

### 3.3.5 其他零售业维度
### 3.3.6 事务号码的退化维度

## 3.4 实际的销售模式
* 如果查询工具按照周结束日期和促销分组汇总销售数量，可以清楚看到维度模型与管理查询之间的关系。
* 高质量维度属性是至关重要的，因为它们是查询约束和报表标签的来源。

## 3.5 零售模式的扩展能力
* 处理新出现的频繁购物者信息相对来说比较直接。建立新的频繁购物者维度表，并在事实表上增加一个外键。

## 3.6 无事实的事实表

## 3.7 维度与事实表键
### 3.7.1 维度表代理键
* 维度表的唯一主键应该是代理键而不是来自于操作型系统的标识符，也就是所谓的自然键。
* 代理键一般为自增，没有业务意义
* 优点
  * 为数据仓库缓冲操作型系统的变化
  * 集成多个源系统
  * 改进性能
  * 处理空值或未知条件
  * 支持维度属性变化跟踪

### 3.7.2 维度中自然和持久的超自然键
* 由操作型系统分配和使用的自然键使用其他名称，例如业务键、产品键和操作键等，用NK标识标识。
* 如果自然键来自于多个源，可以使用字符日期类型作为源代码。

### 3.7.3 退化维度的代理键

### 3.7.4 日期维度的智能键
### 3.7.5 事实表的代理键
* 和维度表代理键一样，但不要求一定使用，事实表的代理键通常只对ETL处理有帮助。
  * 直接的唯一标识
  * 返回或恢复海量加载
  * 插入加删除的替换更新
  * 使用事实键把代理键作为父子模式中的父节点

### 3.8 抵制规范化的冲动
### 3.8.1 具有规范化维度的雪花模式
### 3.8.2 支架表
### 3.8.3 包含大量维度的蜈蚣事实表

# 第四章 库存
## 4.1 价值链简介
* 标明了组织主要活动的自然的、逻辑的流程。
* 操作型源系统通常在价值链的每个步骤建立事务或快照。多数分析型DW/BI系统的主要目标是监控关键步骤的性能结果。因为每个步骤以唯一时间间隔，唯一的粒度和维度产生唯一的度量，所以每个过程通常包含一个或多个事实表。

## 4.2 库存模型
### 4.2.1 库存周期快照
#### 1. 半可加事实
#### 2. 增强型库存事实

### 4.2.2 库存事务
### 4.2.3 库存累积快照

## 4.3 事实表类型
* 事实表的三种基本类型
  * 事务
  * 周期快照
  * 累积快照
### 4.3.1 事务事实表
### 4.3.2 周期快照事实表
### 4.3.3 累积快照事实表
### 4.3.4 辅助事实表类型

## 4.4 价值链集成
## 4.5 企业数据仓库总线架构
### 4.5.1 理解总线架构
* 提供了一种分解企业DW/BI规划任务的合理方法。
* 保证DW/BI管理者在两个领域都能获得好处。有结构框架指导总体设计，但将问题都划分为大小合适的业务过程块，可以在现实的时间框架内实现。不同开发组遵循该架构，工作最终是异步独立开展的。
* 总线架构独立于技术和数据库平台。

### 4.5.2 企业数据仓库总线矩阵
* 业务过程被标识为矩阵行，通过矩阵识别业务过程
#### 1. 使用多矩阵
#### 2. 机会、利益相关方矩阵
#### 3. 常见总线矩阵错误
* 基于部门的或包含太多的行
* 报表为中心或定义过于狭窄的行
* 过度宽泛的列
* 将层次中的每个级别放入不同列
#### 4. 改进现存模型成为总线矩阵

## 4.6 一致性维度
* 一致性维度共享跨企业过程的事实表。首先在ETL系统建立，然后逻辑上或物理上复制到DW/BI环境中。

### 4.6.1 多事实表钻取
### 4.6.2 相同的一致性维度
### 4.6.3 包含属性子集的缩减上卷一致性维度
### 4.6.4 包含子集的缩减一致性维度
### 4.6.5 总线矩阵的缩减一致性维度
### 4.6.6 有限一致性
### 4.6.7 数据治理与管理的重要性
#### 1. 业务驱动的治理
* 来自组织
* 对企业的操作具有广泛的了解
* 能够平衡组织与部门需要
* 具有权威能够挑战现状并执行政策
* 强大的沟通能力
* 具有精明地组织谈判并达成一致的能力
#### 2. 治理目标
* 针对数据定义、标识、领域值达成一致，确保大家使用同一种语言交谈。

#### 4.6.8 一致性维度与敏捷开发

## 4.7 一致性事实

# 第五章 采购
## 5.1 采购案例研究
## 5.2 采购事务与总线矩阵

### 5.2.1 单一事务事实表与多事务事实表
### 5.2.2 辅助采购快照
## 5.3 缓慢变化维度(SCD)基础
## 5.4 混合缓慢变化维度技术
## 5.5 缓慢变化维度总结

# 第六章 订单管理

# 第七章 会计

# 第八章 客户关系管理

# 第九章 人力资源管理

# 第十章 金融服务

# 第十一章 电信

# 第十二章 交通运输

# 第十三章 教育

# 第十四章 医疗卫生

# 第十五章 电子商务

# 第十六章 保险业务

# 第十七章 Kimball DW/BI 生命周期概述

# 第十八章 维度建模过程与任务

# 第十九章 ETL子系统与技术

# 第二十章 ETL系统设计与开发过程和任务

# 第二十一章 大数据分析