# 第一章 数据仓库、商业智能及维度建模初步
* DW/BI的业务驱动目标
* 发布DW/BI系统的隐喻
* 维度建模核心概念及涉及的主要词汇，包括事实表与维度表
* Kimball DW/BI架构的组件与原则
* 不用DW/BI架构的比较研究，维度建模在不同架构中所扮演的角色
* 有关维度建模的误解

## 1.1 数据获取与数据分析的区别
* 操作型系统保存数据，DW/BI系统使用数据。
* 操作型系统优化的目的使更快地处理单条事务。
* DW/BI系统一次处理大量事务，优化的目的是高性能地完成查询。

## 1.2 数据仓库与商业智能的目标
* 收集了海量数据，但无法对其访问
* 需要以各种方式方便地对数据进行切片切块
* 业务人员需要方便地获得数据
* 展示最重要的事情
* 利用数据进行决策而不是争论数据的准确性
* 使人们能够使用信息来支持更多的基于事实的决策制定
* DW/BI系统的业务需求
  * 方便地存取信息，其内容必须使易于理解的，对业务用户（不仅是开发人员）来说，数据要有直观性。数据结构与标识必须符合用户的思维过程和词汇。业务用户能以各种形式分割和合并分析数据。访问数据的工具和应用要简单易用，性能良好（简单快捷）。
  * 必须以一致的形式展现信息。精心组织不同来源的数据，实现数据清洗，确保质量，只有在数据真正适合用户时发布。一致性也意味着表示DW/BI系统内容的公共标识和定义，可在不用数据源共用。保证同名同意性和异名异名性。
  * 必须能适应变化。当业务问题发生变化或新数据添加到数据仓库中时，已存在的数据和应用不应该被改变或破坏。如果必须修改系统中的描述性数据，要能以适当的方式描述变化，并使这些变化对用户来说是透明的。
  * 必须能够及时展现信息。
  * 必须成为保护信息财富的安全堡垒。
  * 必须称为提高决策制定能力的权威和可信的基础。
  * 成功的标志是业务群体接受DW/BI系统。
* 最后两项至关重要。

### 以出版发行工作为例说明BW/BI管理者的职责
* 理解读者
  * 读者的人口统计学特征
  * 读者希望的内容
  * 高价值客户
  * 潜在的新读者
* 确保杂志对读者具有吸引力
  * 内容要有吸引力
  * 杂志的布局和设计要喜闻乐见
  * 高质量的写作和编辑标准，且具有一致性
  * 不断地监控杂志中文章的准确性以及广告商的要求
  * 根据读者和撰稿人网络的新情况适时改变读者信息及保证修改即时可用
* 维持出版
  * 吸引广告商，带来利润
  * 定期出版杂志
  * 保持读者对杂志的信任
  * 让投资人满意

#### DW/BI管理者的责任
* 理解业务用户
  * 理解他们的工作责任、目标和任务
  * 确定商业用户在制定出高效率、高影响的决策的最佳用户
  * 发现潜在的新用户，并让他们意识到DW/BI系统带来的好处
* 对业务用户发布高质量、相关的、可访问的信息和分析
  * 选择最健壮的、可操作的数据放入DW/BI系统中，从组织机构的各种数据源中仔细选择。
  * 简化用户接口和应用，采用模板驱动的方式，与用户的认知过程轮廓匹配
  * 确保数据精确、可信，使其标识在整个企业具有一致性
  * 不间断地监控数据和分析的准确性
  * 适应用户不断变化的思维方式、需求和业务优先级，及新数据源的可用性
* 维护DW/BI环境
  * 采用DW/BI系统制定成功的业务决策，验证人员配置及要投入的开支
  * 定期对DW/BI系统进行更新
  * 保持业务用户的信任
  * 保持业务用户、执行赞助商和IT管理层满意度

## 1.3 维度建模简介
* 需求
  * 以商业用户可理解的方式发布数据
  * 提供高效的查询性能
* 维度模型通常应用在关系型数据库管理系统上，但不要求维度模型必须满足第三范式(3NF)。数据库中强调3NF主要使为了消除冗余。规范化的3NF将数据划分为多个不同的实体，每个实体构成一个关系表。
* 规范化的3NF模型对于BI来说太复杂。用户难以理解、检索和记忆。而且多数数据库管理系统不能有效地查询规范化模型，用户查询难以预测的复杂性将耗尽数据库资源，产出灾难性的后果。在DW/BI这样展现系统中使用规范化建模方法难以满足对数据的高性能检索需求。维度建模解决了模式过分复杂的问题。

### 1.3.1 星型模式与OLAP多维数据库
* 在关系数据库管理系统中实现的维度模型称为星型模式。
* 在多维数据库环境中实现的维度模型称为OLAP。
* 星型模式和多维数据库对可识别的维度具有公共的逻辑设计，但在物理实现上存在差异。
### 1.3.2 用于度量的事实表
* 存储机构业务过程事件的表现度量结果。应该尽量将来源于同一个业务过程的底层度量结果存储于一个维度模型中。
* 因为度量的数据量巨大，不应该为满足多个组织功能的需要而分开存放数据，而应该允许多个组织业务用户访问同一个单元的集中式数据仓库，确保他们能在整个企业中使用一致的数据。
* "事实"这一术语表示某个业务度量，事实表中的每行对应一个度量事件。每行中的数据是一个特定级别的细节数据，称为粒度。
* 物理世界的每一个度量事件于对应的事实表具有一对一的关系，这一思想是维度建模的基本原则。其他工作都是以此为基础建立的。
* 可加性是至关重要的，应为BI应用会检索大量的行，所以常见的操作是将它们加到一起。销售数量和金额具有可加性，账户结余只有半可加性，而单位价格不可加。面对这种情况时，会不得不进行计数或取均值操作。
* 事实通常以连续值描述，这样做有助于区分到底是事实还是属性维度的问题。例如销售额是连续值，这样它可以在一定范围内表示实际可能存在的所有值。必须面向市场，研究度量，以确定其度量值到底应该是什么。
* 没有发生的事实不要插入任何行，不要试图以0表示没有活动发生。
* 事实表的粒度可划分为三类：事务、周期性快照和积累快照。事务粒度级别的事实表最常见。
* 事实表通常具有两个或更多个外键与维度表的主键关联。
* 事实表通常包含外键集合的主键，事实表的主键常称为组合键，具有组合键的表称为事实表，表示多对多关系。其他表称为维度表。
* 通常几个维度一起标识每个事实表行。当确定了所有维度中唯一标识事实表行的子集后，其他维度使用事实表行的主键单一值，其他维度只是参于其中。

### 1.3.3 用于描述环境的维度表
* 维度表是事实表不可或缺的组成部分，包含与业务过程度量事件有关的文本环境。它们用于描述与"who, what, where, when, why, how"有关的事件。
* 维度表通常有多列，包含多个属性。有上百个属性的维度表并不稀奇。与事实表相比，维度表趋向于包含较少的行，但由于可能存在大量文本列而导致存在多列的情况。每个维度表由单一主键定义，用于在事实表连接操作时实现参照完整性的基础。
* 维度属性可作为查询约束、分组、报表标识的主要来源。属性应该使用真实词汇而不是缩写或代码。
* 数据仓库的好坏直接取决于维度属性的设置，DW/BI的分析能力直接取决于维度属性的质量和深度。为维度属性提供详细的业务术语耗费的精力阅读，效果就越好。为属性列填充领域值耗费的精力越多，效果就越好。为确保属性值的质量耗费的时间越多，效果就越好。强大的维度属性带来的回报是健壮的分片-分块分析能力。
* 分析操作型源数据时，有时不清楚一个数值数据元素应该时事实属性还是维度属性。可用通过分析该列是否是一种包含多个值并作为计算的参与者的度量，这种情况下该列往往可能是事实。如果该列是对具体值的描述，是一个常量、某一约束和行标识的参与者，此时该属性往往是维度属性。
* 一个数字是事实还是维度，是一个两难的问题。连续的数字基本上可以认为属于事实，来自一个不太大的列表的离散数字基本可以认为是维度属性。
* 维度表通常比较小，因此采用规范化或雪花模式对数据库总量没有很大影响。一般对维度空间表存储空间的权衡往往需要关注简单性和可访问性。

### 1.3.4 星型模式中维度与事实的连接
* 星型连接：维度模型表示每个业务过程包含事实表，事实表存储事件的数值化度量，围绕事实表的是多个维度表，维度表包含事件发生时实际存在的文本环境。
* 对维度模式首先要注意的时其简单性和对称性。显然，简单性对业务用户有利，因为数据易于理解和查询。
* 维度模型的简单性也带来性能上的好处，数据库优化器处理这些很少使用连接操作的简单模式会更高效。
* 维度模型非常适用于变化，它可预测的框架可适应用户行为的变化。每个维度的地位都相同，所有维度在事实表中都存在对应的入口点。
* 粒度最小的数据或原子数据具有最多的维度。尚未聚集的原子数据时最具有可表达性的数据。这些原子数据是构建能满足用户提出任意查询的事实表的设计基础。
  * 可以将全新维度增加到模式中，只要该维度的单一值被定义到已经存在的事实表行中。
  * 同样，可以将新的事实添加到事实表中，前提是其细节级别与当前事实表保持一致。
  * 可以向已存在的维度表添加新属性，对上述情况，可以通过简单增加数据行或通过执行SQL ALTER TABLE命令对当前表进行更新。不需要重新加载数据，已经建立的BI系统应用可不间断允许，不会产生不同的结果。

## 1.4 Kimball的DW/BI架构
* 四个不同的组成部分
  * 操作型源系统
  * ETL系统
  * 数据展现
  * 商业智能应用

### 1.4.1 操作型源系统
* 记录的操作型系统，用于获取业务事务，处于数据仓库之外，几乎不能控制这些操作型系统中数据的格式和内容。
* 关注处理性能和可用性。
* 查询是简单的，以一次一条记录的查询方式构成常见的事务流，通常不能实现类似DW/BI系统那样广泛的、无法预料的查询方式的特点。
* 一般不维护历史信息，好的数据仓库来承担这个责任。
* 一种针对特定意图的应用，并未承诺要与组织中其他操作型系统共享诸如产品、客户、区域、日期这样的公共数据。

### 1.4.2 获取-转换-加载(ETL)系统
* 包括一个工作区间、实例化的数据结构以及一个过程集合。是处于操作型源系统与DW/BI展现系统之间的区域。
* 获取是将数据从操作型系统导入到数据仓库这一ETL过程的第一步，意味着读取并立即源数据并将需要的数据复制到ETL系统中以利于后续的处理操作。
* 获取到ETL系统后，需要进行多种转换操作，例如清洗数据，合并不同来源的数据，复制数据等。ETL系统通过增强或数据变换，采用清洗和整合上述任务的方法，增加数据的利用价值。这些工作还可以建立诊断元数据，逐步建立业务过程再工程以改进源系统的数据质量。
* 最后的步骤就是实际构建和加载数据到展现区域的目标维度模型中。因为ETL系统的注意任务是在交付过程中划分维度和事实，因此其所包含的子系统非常重要。此处定义的子系统关注维度表的处理，例如代理键分配、查找代码以提供适当的描述、拆分或组合列以提供适当的数据值、连接满足第三范式的数据表成为扁平的不满足规范化要求的维度等。相比之下，事实表往往比较庞大，因此在加载时需要大量时间，将其加载并导入到展现区是必须开展的工作。当维度模型中的维度表和事实表被更新、索引、适当聚集并确保良好质量后，业务用户就可以开始使用这样数据了。

### 1.4.3 用于支持商业智能决策的展现区
* ETL不允许用户直接查询，所以DW/BI环境中的展现区成为用户关注的区域。
* 数据应该以维度模型来展现，要么采用星型模式，要么采用OLAP多维数据库。
* 必须包含详细的原子数据。为满足用户无法预期的、随意的查询，必须使用原子数据。尽管在展现区，为提高性能也会存储聚集数据，但若仅有这些汇总数据而没有形成汇总数据的细粒度数据，则这样的展现区是不完整的。
* 展现区的数据可以围绕业务度量事件来构建。采用这一方法可以自然地裁剪操作型源数据获取系统。维度模型应该对应物理数据获取事件，不应该将它们设计为仅为完成每天的报表工作。应该为原始的销售矩阵建立单一事实表而不是仅从相似性来考虑问题。数据库的销售矩阵应该包含与销售、市场、部门和财务有关的项。
* 必须使用公共的、一致性的维度建立维度结构。
* 利用总线结构建立分布式DW/BI系统是成功的关键。将总线结构作为级别框架，可采用敏捷的、分散的、范围合适的、迭代的方式建立企业数据仓库。

### 1.4.4 商业智能应用
* BI应用可以简单或复制。多数业务用户可能通过预先构建参数驱动的应用和模板访问数据，不需要用户直接构建查询。对那些更加复杂的应用，可以将结果上传值操作型源系统、ETL系统或展现区中。

### 1.4.5 以餐厅为例描述Kimball架构
#### 1. ETL系统与餐厅后厨
* 自成体系，不受外界业务打扰。
* ETL系统需要高度关注数据质量、完整性、一致性。输入数据时要检查其质量。不断地监视相关的环境以确保ETL输出的数据具有高度的完整性。
* 设计恰当的DW/BI环境将平衡前端BI应用以支撑后端ETL系统。前端的工作需要由商业用户多次反复实现，后端工作由ETL人员一次实现。
* ETL系统应该与业务用户和BI应用开发者保持一定距离。

#### 2. 处于前端用餐区的数据展现与BI
* DW/BI系统提供菜单，通过元数据、发布报表、参数化分析应用等告诉用户什么数据可用。用户希望获得一致的、良好的数据质量。展现区的数据应该根据要求准备并保证安全。
* 展现区的"装修风格"应该让用户感觉舒服，应该按照BI使用者的口味而不是开发者的喜好进行设计。
* 成本也是必须考虑的问题。

## 1.5 其他DW/BI架构
### 1.5.1 独立数据集市架构

### 1.5.2 辐射状企业信息工厂Inmon架构

### 1.5.3 混合辐射状架构与Kimball架构

## 1.6 维度建模Myth
### 1.6.1 Myth 1: 维度模型仅包含汇总数据
* 汇总数据只是针对公共查询时能够比粒度数据提供更好的性能，但它不能取代细节数据。
* 维度模型不反对存储大量历史数据，但是必须由业务需求来驱动。

### 1.6.2 Myth 2: 维度模型是部门级而不是企业级的
* 应该避免多次获取同一个数据源的数据，这样做会产生多个不一致的分析数据库

### 1.6.3 Myth 3: 维度模型是不可扩展的
* 好的维度模型非常易于扩展。

### 1.6.4 Myth 4: 维度模型仅用于预测

### 1.6.5 Myth 5: 维度模型不能被集成
* 如果遵从企业数据仓库总线结构，维度模型多数都能被集成。

## 1.7 考虑使用维度模型的更多理由
### 敏捷性
* 多数敏捷方法的核心原则与Kimball最佳实践契合
  * 关注发布业务值
  * 开发小组与业务相关方之间的值合作
  * 强调与业务相关方开展面对面的沟通、反馈、优化。
  * 快速适应不可避免的需求变化
  * 以迭代、增量方式处理开发过程

# 第二章 Kimball维度建模技术概述

# 第三章 零售业务

# 第四章 库存

# 第五章 采购

# 第六章 订单管理

# 第七章 会计

# 第八章 客户关系管理

# 第九章 人力资源管理

# 第十章 金融服务

# 第十一章 电信

# 第十二章 交通运输

# 第十三章 教育

# 第十四章 医疗卫生

# 第十五章 电子商务

# 第十六章 保险业务

# 第十七章 Kimball DW/BI 生命周期概述

# 第十八章 维度建模过程与任务

# 第十九章 ETL子系统与技术

# 第二十章 ETL系统设计与开发过程和任务

# 第二十一章 大数据分析